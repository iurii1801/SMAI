# Лабораторная работа №4. Анализ и расширенная визуализация данных в Zabbix

## Цель работы

Ознакомление с расширенными возможностями платформы `Zabbix`: создание графиков и отчётов, использование сложных элементов (`item`), корреляция метрик и оптимизация системы мониторинга.

## Задачи

- Использовать зависимые (dependent) и вычисляемые (calculated) элементы данных.
- Настраивать шаблоны (templates) для групп хостов.
- Создавать пользовательские графики и автоматические отчёты.
- Интерпретировать и сопоставлять собранные данные (например, CPU + память + сеть).
- Настраивать условные оповещения по нескольким критериям.
- Оптимизировать параметры сбора данных и уведомлений.

## Необходимое оборудование и программное обеспечение

- Рабочий сервер Zabbix (установленный на предыдущей лабораторной работе).
- Как минимум один хост с активным Zabbix Agent.
- Доступ к веб-интерфейсу Zabbix с правами администратора.

---

## Ход выполнения работы

### Шаг 1. Создание собственного шаблона

Для организации мониторинга необходимо создать собственный шаблон, содержащий набор элементов данных и триггеров.
Шаблон позволяет централизованно собирать и анализировать ключевые метрики системы, такие как загрузка процессора, использование памяти, сетевой трафик и дисковое пространство.

#### Создание шаблона Template IT-System-Monitoring

Для создания шаблона необходимо перейти в раздел
**Configuration → Templates → Create template**.

В открывшемся окне указываются параметры, представленные в таблице:

| Параметр           | Значение                      |
| ------------------ | ----------------------------- |
| **Template name**  | Template IT-System-Monitoring |
| **Template group** | Templates                     |

![image](https://i.imgur.com/1wS3cHn.png)

После заполнения полей следует нажать **Add**.
Система выводит уведомление *Template added*, подтверждающее успешное создание шаблона.

![image](https://i.imgur.com/ZTTCYMK.png)

#### Добавление элементов данных (Items)

После создания шаблона необходимо добавить элементы данных, которые будут собирать информацию о состоянии системы.
Для этого требуется открыть вкладку **Items** и добавить следующие элементы:

| № | Название элемента   | Ключ (Key)                   | Интервал опроса | Тип данных         | Единицы |
| - | ------------------- | ---------------------------- | --------------- | ------------------ | ------- |
| 1 | CPU Load avg1       | `system.cpu.load[all,avg1]`  | 30s             | Numeric (float)    | load    |
| 2 | CPU Load avg5       | `system.cpu.load[all,avg5]`  | 30s             | Numeric (float)    | load    |
| 3 | CPU Load avg15      | `system.cpu.load[all,avg15]` | 30s             | Numeric (float)    | load    |
| 4 | Disk Space Used %   | `vfs.fs.size[/,pused]`       | 1m              | Numeric (unsigned) | %       |
| 5 | Network Traffic In  | `net.if.in[eth0,bytes]`      | 30s             | Numeric (unsigned) | Bps     |
| 6 | Network Traffic Out | `net.if.out[eth0,bytes]`     | 30s             | Numeric (unsigned) | Bps     |
| 7 | RAM Used %          | `ram.used.pct`               | 30s             | Calculated         | %       |


![image](https://i.imgur.com/uveWLZV.png)
![image](https://i.imgur.com/II7WMXE.png)
![image](https://i.imgur.com/jfJLqcs.png)
![image](https://i.imgur.com/8K8tthz.png)
![image](https://i.imgur.com/Dbr7o5R.png)
![image](https://i.imgur.com/WOvmRza.png)
![image](https://i.imgur.com/1RJK4OJ.png)
![image](https://i.imgur.com/WOvmRza.png)

> Для элементов **Network Traffic In** и **Network Traffic Out** во вкладке **Preprocessing** добавляется шаг обработки:
>
>```
>Change per second
>```
>
>Этот шаг преобразует накопленные байты в показатель скорости передачи данных (Bps).

>При необходимости имя интерфейса (`eth0`) заменяется на фактическое (например, `ens33` или `enp0s3`).
>
>Для элемента **RAM Used %** (тип *Calculated*) формула вычисления имеет вид:
>
>```
>((last(//vm.memory.size[total]) - last(//vm.memory.size[available])) / last(//vm.memory.size[total])) * 100
>```
>Данный элемент позволяет вычислить процент использования оперативной памяти без необходимости прямого запроса к агенту.

После добавления всех элементов шаблон содержит 7 активных элементов со статусом **Enabled**.

![image](https://i.imgur.com/0ZdKW9p.png)

#### Добавление триггера «High load»

При добавлении триггера вручную может возникнуть ошибка синтаксиса выражения:

```
{Template IT-System-Monitoring:system.cpu.load[all,avg1].min(5m)}>2
```

система выдает сообщение об ошибке:

> *Expression syntax error: incorrect expression starting from "{Template IT-System-Monitoring:system.cpu.load[all,avg1].min(5m)}>2"*

![image](https://i.imgur.com/2Bzwqf1.png)

Для корректного создания выражения необходимо воспользоваться **Expression constructor**.
В конструкторе выбирается элемент `CPU Load avg1`, затем в поле **Function** указывается `min()` — Minimum value for period T,
в поле **Last of (T)** задаётся `5m`, а в **Result** — условие `> 2`.

![image](https://i.imgur.com/O9DQzGQ.png)

После нажатия **Insert** конструктор формирует правильное выражение:

```
{Template IT-System-Monitoring:system.cpu.load[all,avg1].min(5m)}>2
```

Затем триггер успешно создаётся, и Zabbix отображает уведомление *Trigger added*.

![image](https://i.imgur.com/uBize74.png)

В результате выполнения данного шага создан шаблон **Template IT-System-Monitoring**, включающий:

- семь элементов данных для мониторинга ключевых параметров системы;
- триггер **High load**, фиксирующий превышение допустимой нагрузки на процессор.

Созданный шаблон используется для привязки к хосту Zabbix и сбора метрик в реальном времени.
На следующем этапе данный шаблон будет привязан к хосту для проверки корректности сбора данных и визуализации метрик.

### Шаг 2. Применение шаблона к хосту

Для активации мониторинга созданный шаблон необходимо привязать к существующему хосту, на котором установлен агент Zabbix.
Это позволяет автоматически собирать метрики системы, определённые в шаблоне, и отображать их в интерфейсе Zabbix.

#### Привязка шаблона к хосту

Необходимо перейти в раздел
**Configuration → Hosts**,
выбрать хост **zabbix-agent** и открыть его настройки.

В разделе **Templates** добавляется созданный шаблон
**Template IT-System-Monitoring**.
Так как шаблон *Linux by Zabbix agent* содержит аналогичные элементы, во избежание конфликта он был удалён с помощью опции
**Unlink and clear**.

После этого хост содержит только один активный шаблон — **Template IT-System-Monitoring**, который отвечает за сбор и визуализацию всех необходимых метрик.

![image](https://i.imgur.com/WvvPJTg.png)

#### Обновление и результат

После нажатия кнопки **Update** система отображает сообщение
**Host updated**, что подтверждает успешное применение шаблона.

![image](https://i.imgur.com/gsoR12C.png)

Теперь хост связан с пользовательским шаблоном, и сбор данных осуществляется по заданным элементам: загрузке процессора, использованию памяти, сетевому трафику и дисковому пространству.

В результате шаблон успешно применён к хосту, метрики начали собираться автоматически, что подтверждает корректность настройки Zabbix для дальнейшей визуализации данных.

### Шаг 3. Создание зависимых и вычисляемых элементов данных

Для демонстрации возможностей расширенного анализа в Zabbix были созданы **два дополнительных элемента данных**:

1. *Вычисляемый (Calculated)* — для оценки соотношения между загрузкой CPU и использованием оперативной памяти.
2. *Зависимый (Dependent)* — для извлечения числового значения из текстового поля `system.uptime`.

#### Создание вычисляемого элемента (Calculated Item)

Необходимо открыть шаблон
**Configuration → Templates → Template IT-System-Monitoring → Items**
и нажать **Create item**.

Параметры заполняются следующим образом:

| Параметр                   | Значение                                                   |
| -------------------------- | ---------------------------------------------------------- |
| **Name**                   | RAM/CPU Efficiency Ratio                                   |
| **Type**                   | Calculated                                                 |
| **Key**                    | ram.cpu.ratio                                              |
| **Type of information**    | Numeric (unsigned)                                         |
| **Formula**                | `last(//ram.used.pct) / last(//system.cpu.load[all,avg5])` |
| **Units**                  | %                                                          |
| **Update interval**        | 1m                                                         |
| **History storage period** | 90d                                                        |
| **Trend storage period**   | 365d                                                       |

![image](https://i.imgur.com/4BRkEua.png)

После сохранения система отображает уведомление
**Item added**, что подтверждает успешное создание вычисляемого элемента.

![image](https://i.imgur.com/mPvLXrN.png)

#### Создание зависимого элемента (Dependent Item)

Для реализации извлечения числового значения из текстового параметра `system.uptime`
создаётся зависимый элемент.

| Параметр                   | Значение               |
| -------------------------- | ---------------------- |
| **Name**                   | Uptime (numeric only)  |
| **Type**                   | Dependent item         |
| **Key**                    | system.uptime.numeric  |
| **Type of information**    | Numeric (unsigned)     |
| **Master item**            | `Linux: System uptime` |
| **Units**                  | sec                    |
| **History storage period** | 90d                    |
| **Trend storage period**   | 365d                   |

![image](https://i.imgur.com/mn0tYNl.png)

На вкладке **Preprocessing** добавляется шаг предобработки:

| Шаг | Тип обработки      | Параметры                        |
| --- | ------------------ | -------------------------------- |
| 1   | Regular expression | Pattern: `(\d+)`<br>Output: `\1` |

![image](https://i.imgur.com/5e8Y40l.png)

Этот шаг извлекает только числовое значение (например, количество секунд) из текстового формата аптайма (`"15 days, 02:13:09"` → `1308690`).

После нажатия **Add** система подтверждает создание зависимого элемента сообщением
**Item added**.

#### Проверка результата

В результате выполнения шага шаблон **Template IT-System-Monitoring** содержит:

- 10 активных элементов данных;
- один вычисляемый элемент (`RAM/CPU Efficiency Ratio`);
- один зависимый элемент (`Uptime (numeric only)`).

![image](https://i.imgur.com/qe4nl2x.png)

### Шаг 4. Визуализация и дашборды

Для наглядного анализа собранных метрик был создан дашборд, объединяющий графики, таблицы и сводки тревог в системе Zabbix.
Дашборд позволяет наблюдать за динамикой загрузки процессора, использованием памяти, основными процессами и текущими проблемами в реальном времени.

#### Создание графика «CPU vs RAM Usage»

Для визуализации совместной динамики загрузки процессора и использования оперативной памяти был создан график **CPU vs RAM Usage**.

Необходимо открыть шаблон
**Configuration → Templates → Template IT-System-Monitoring → Graphs**
и нажать **Create graph**.

Параметры заполняются следующим образом:

| Параметр               | Значение                                     |
| ---------------------- | -------------------------------------------- |
| **Name**               | CPU vs RAM Usage                             |
| **Graph type**         | Normal                                       |
| **Width**              | 900                                          |
| **Height**             | 200                                          |
| **Show legend**        | ✓                                            |
| **Show working time**  | ✓                                            |
| **Show triggers**      | ✓                                            |
| **Y axis MIN value**   | Calculated                                   |
| **Y axis MAX value**   | Calculated                                   |
| **Item 1 Name**        | Template IT-System-Monitoring: CPU Load avg5 |
| **Item 1 Draw style**  | Line                                         |
| **Item 1 Y axis side** | Left                                         |
| **Item 1 Color**       | Red                                          |
| **Item 2 Name**        | Template IT-System-Monitoring: RAM Used %    |
| **Item 2 Draw style**  | Line                                         |
| **Item 2 Y axis side** | Left                                         |
| **Item 2 Color**       | Green                                        |

![image](https://i.imgur.com/V80ZNb8.png)

После сохранения система отображает уведомление
**Graph added**, подтверждающее успешное создание графика.

![image](https://i.imgur.com/dmTuGmo.png)

#### Создание нового дашборда

Для отображения графиков и таблиц создаётся новый дашборд.
Необходимо перейти в **Monitoring → Dashboards** и выбрать **Create dashboard**.

| Параметр                          | Значение                     |
| --------------------------------- | ---------------------------- |
| **Name**                          | IT System Monitoring         |
| **Owner**                         | Admin (Zabbix Administrator) |
| **Default page display period**   | 30 seconds                   |
| **Start slideshow automatically** | ✓                            |

![image](https://i.imgur.com/ENE112I.png)

После нажатия **Apply** система создаёт пустой дашборд, готовый к добавлению виджетов.

#### Добавление виджета «CPU vs RAM Usage»

Для вывода ранее созданного графика на панель необходимо добавить виджет:

1. Нажать **Add → Graph (classic)**.
2. Заполнить параметры:

| Параметр                  | Значение                       |
| ------------------------- | ------------------------------ |
| **Type**                  | Graph (classic)                |
| **Name**                  | CPU vs RAM Usage               |
| **Refresh interval**      | Default (1 minute)             |
| **Source**                | Graph                          |
| **Graph**                 | zabbix-agent: CPU vs RAM Usage |
| **Show legend**           | ✓                              |
| **Enable host selection** | ✗                              |

![image](https://i.imgur.com/z0oaoI9.png)

После добавления график отображается на дашборде и начинает обновляться каждые 60 секунд.

![image](https://i.imgur.com/opE9Qz4.png)

#### Добавление виджета «Top 5 Processes»

Для отображения системных показателей хоста в виде таблицы используется виджет **Data overview**.
В нём можно просматривать ключевые процессы и метрики системы.

| Параметр             | Значение           |
| -------------------- | ------------------ |
| **Type**             | Data overview      |
| **Name**             | Top 5 Processes    |
| **Refresh interval** | Default (1 minute) |
| **Host groups**      | Linux servers      |
| **Hosts**            | zabbix-agent       |
| **Show header**      | ✓                  |
| **Hosts location**   | Left               |

![image](https://i.imgur.com/ObJzggT.png)

После сохранения таблица отображает значения метрик, включая загрузку CPU, RAM, uptime и сетевой трафик.

![image](https://i.imgur.com/GslbTdV.png)

#### Добавление виджета «Alert Summary»

Для отображения активных и последних тревог создаётся виджет **Problems**.
Он помогает быстро выявлять проблемы и отслеживать их статус.

| Параметр                  | Значение           |
| ------------------------- | ------------------ |
| **Type**                  | Problems           |
| **Name**                  | Alert Summary      |
| **Refresh interval**      | Default (1 minute) |
| **Show**                  | Recent problems    |
| **Host groups**           | Linux servers      |
| **Hosts**                 | zabbix-agent       |
| **Severity**              | Все уровни         |
| **Show header**           | ✓                  |
| **Show tags**             | None               |
| **Show operational data** | None               |
| **Show symptoms**         | ✗                  |

![image](https://i.imgur.com/0rz9Gd3.png)

#### Итоговый дашборд

После добавления всех виджетов сформирован дашборд **IT System Monitoring**, включающий:

| № | Виджет               | Назначение                                            |
| - | -------------------- | ----------------------------------------------------- |
| 1 | **CPU vs RAM Usage** | Отображает динамику загрузки CPU и использования RAM. |
| 2 | **Top 5 Processes**  | Показывает основные метрики и загрузку системы.       |
| 3 | **Alert Summary**    | Отображает активные и последние системные тревоги.    |

![image](https://i.imgur.com/6itxhHa.png)

В результате выполнения шага был создан дашборд с ключевыми метриками и визуализациями, позволяющий отслеживать состояние системы в реальном времени и оперативно реагировать на возможные отклонения.

### **Шаг 5. Создание условных оповещений и действий (Triggers и Actions)**

Для автоматического уведомления администратора при превышении пороговых значений загрузки CPU и использования оперативной памяти были созданы триггер и действие.

#### **Создание триггера (Trigger)**

Открывается шаблон
**Configuration → Templates → Template IT-System-Monitoring → Triggers → Create trigger.**

| Параметр                          | Значение                                                                                                                    |
| --------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| **Name**                          | High CPU and RAM usage                                                                                                      |
| **Severity**                      | High                                                                                                                        |
| **Expression**                    | `last(/Template IT-System-Monitoring/system.cpu.load[all,avg5])>2 and last(/Template IT-System-Monitoring/ram.used.pct)>80` |
| **OK event generation**           | Expression                                                                                                                  |
| **PROBLEM event generation mode** | Single                                                                                                                      |
| **Status**                        | Enabled                                                                                                                     |

![image](https://i.imgur.com/YKz9nLM.png)

Ошибка появляется!

Выражение необходимо создать через **Expression constructor**, где необходимо добавить два условия:

1. `CPU Load avg5 > 2`
2. `RAM Used % > 80`
   Оператор **AND** объединяет оба условия, чтобы триггер активировался только при одновременном превышении порогов.

![image](https://i.imgur.com/QThkZwI.png)
![image](https://i.imgur.com/mTNM9v5.png)
![image](https://i.imgur.com/4UyfNGo.png)

#### **Создание действия (Action)**

Переходим в раздел
**Alerts → Actions → Trigger actions → Create action.**

| Параметр      | Значение                                              |
| ------------- | ----------------------------------------------------- |
| **Name**      | High CPU and RAM Alert                                |
| **Condition** | Trigger equals `zabbix-agent: High CPU and RAM usage` |
| **Enabled**   | ✓                                                     |

![image](https://i.imgur.com/J1rTRov.png)
![image](https://i.imgur.com/CpCTJ7U.png)

#### **Добавление операции (Operation)**

На вкладке **Operations** задаются параметры отправки уведомления:

| Параметр           | Значение                     |
| ------------------ | ---------------------------- |
| **Operation type** | Send message                 |
| **Steps**          | 1–1                          |
| **Send to users**  | Admin (Zabbix Administrator) |
| **Send only to**   | Email                        |
| **Step duration**  | 0 (default)                  |

![image](https://i.imgur.com/DTR5GaE.png)

После добавления операции в таблице отображается конфигурация:

| Параметр                                     | Значение                                                      |
| -------------------------------------------- | ------------------------------------------------------------- |
| **Default operation step duration**          | 1h                                                            |
| **Operations**                               | Send message to users: Admin (Zabbix Administrator) via Email |
| **Pause operations for symptom problems**    | ✓                                                             |
| **Pause operations for suppressed problems** | ✓                                                             |
| **Notify about canceled escalations**        | ✓                                                             |

![image](https://i.imgur.com/d4Onwiu.png)

После сохранения система отобразила сообщение **Action added**, подтверждающее успешное создание оповещения.
В списке активных действий появилась новая запись:

![image](https://i.imgur.com/r44P2zx.png)

| Название                   | Условие                                               | Операция                               | Статус  |
| -------------------------- | ----------------------------------------------------- | -------------------------------------- | ------- |
| **High CPU and RAM Alert** | Trigger equals `zabbix-agent: High CPU and RAM usage` | Send message to users: Admin via Email | Enabled |

В результате создано одно условное действие (**High CPU and RAM Alert**) и один триггер, автоматически отправляющий уведомления при превышении порогов. Оповещения отображаются в разделе *Monitoring → Problems*.

### Шаг 6. Экспорт и документирование

Для завершения работы произведён экспорт созданного шаблона, фиксация итогового дашборда и сохранение журналов событий.
Это позволяет задокументировать результаты и подтвердить корректность работы настроенной системы мониторинга.

#### Экспорт шаблона в формате XML

Необходимо открыть меню
**Configuration → Templates**,
выбрать созданный шаблон **Template IT-System-Monitoring** и нажать кнопку **Export**.

Параметры экспорта:

| Параметр     | Значение                                                  |
| ------------ | --------------------------------------------------------- |
| **Template** | Template IT-System-Monitoring                             |
| **Format**   | XML                                                       |
| **Include**  | All elements (Items, Triggers, Graphs, Discovery rules)   |
| **Result**   | Файл `Template_IT-System-Monitoring.xml` успешно сохранён |

![image](https://i.imgur.com/ocwFn8k.png)

![image](https://i.imgur.com/OwQ1INf.png)

#### Сохранение итогового дашборда

На вкладке **Monitoring → Dashboards** отображается созданный дашборд **IT System Monitoring**, включающий ключевые метрики системы.

| № | Виджет               | Назначение                                           |
| - | -------------------- | ---------------------------------------------------- |
| 1 | **CPU vs RAM Usage** | Отображает динамику загрузки CPU и использования RAM |
| 2 | **Top 5 Processes**  | Показывает основные метрики и аптайм системы         |
| 3 | **Alert Summary**    | Отображает активные и последние системные тревоги    |

![image](https://i.imgur.com/SC2DDuf.png)

#### Сохранение журнала событий

Для документирования работы системы предусмотрены журналы **тревог (Problems)** и **действий (Actions)**.
В ходе лабораторной работы настроенные триггеры и оповещения готовы к использованию, но тестовые тревоги не создавались вручную.

| Раздел                    | Назначение                                                                            | Статус                                         |
| ------------------------- | ------------------------------------------------------------------------------------- | ---------------------------------------------- |
| **Monitoring → Problems** | Отображает активные и архивные тревоги, генерируемые при превышении порогов CPU и RAM | Данных нет (система работает в штатном режиме) |
| **Reports → Action log**  | Фиксирует выполнение действий (например, отправку уведомлений e-mail)                 | Активно, журнал пуст (ожидает событий)         |

В результате выполнения шага:

- Шаблон **Template IT-System-Monitoring** успешно экспортирован в формате XML.
- Итоговый дашборд содержит все ключевые метрики системы.
- Настроенные триггеры и действия готовы к автоматическому уведомлению администратора при превышении порогов.
- В данный момент тревог не зафиксировано — система функционирует стабильно.

---

## Контрольные вопросы

**1. В чём разница между элементами *dependent* и *calculated*?**

- *Dependent (зависимый элемент)* — не собирает данные напрямую от агента, а использует уже полученные данные из связанного (master) элемента и может применять к ним предобработку.
- *Calculated (вычисляемый элемент)* — не имеет источника данных, а вычисляет значения по формуле, используя другие элементы и их показатели.

**2. Как можно сопоставлять значения нескольких метрик на одном графике?**

- Для сопоставления метрик используется создание **комбинированных графиков (Graphs)**, где добавляются несколько элементов данных с разными цветами и подписями.
  Это позволяет визуально сравнивать зависимость, например, загрузки CPU и использования памяти во времени.

**3. Почему стоит использовать шаблоны вместо ручной настройки хостов?**

- Шаблоны позволяют **унифицировать** настройки мониторинга для множества хостов.
  Все элементы данных, триггеры и графики создаются один раз, а затем применяются к разным устройствам, что экономит время и снижает риск ошибок при ручной настройке.

**4. Как влияет интервал обновления данных (update interval) на производительность системы?**

- Чем **меньше интервал обновления**, тем чаще выполняются опросы, что повышает точность данных, но увеличивает нагрузку на сервер и сеть.
- При слишком большом интервале данные будут менее актуальны, но система будет работать быстрее и стабильнее.
- Поэтому важно подбирать баланс между точностью мониторинга и производительностью системы.

---

## Вывод

В результате выполнения лабораторной работы были освоены принципы расширенного мониторинга и визуализации данных в системе **Zabbix**. Был создан собственный шаблон, содержащий ключевые элементы данных, триггеры и вычисляемые показатели. Шаблон был успешно применён к хосту, обеспечив сбор и анализ метрик, включая загрузку процессора, использование оперативной памяти, сетевую активность и дисковое пространство. Дополнительно были реализованы зависимые и вычисляемые элементы, что позволило повысить гибкость анализа данных без увеличения нагрузки на систему.

На основе собранных метрик создан дашборд, включающий графики, таблицы и сводки тревог, обеспечивающий наглядное представление состояния системы в реальном времени. Настроенные триггеры и действия позволяют автоматически уведомлять администратора при превышении критических порогов.

Таким образом, поставленные цели лабораторной работы достигнуты: изучены возможности Zabbix по созданию шаблонов, визуализации данных и настройке условных оповещений, что подтвердило практическую готовность системы к эксплуатации в реальных условиях мониторинга.
