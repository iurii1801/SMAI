# Лабораторная работа №3. Мониторинг ИТ-инфраструктуры с использованием Zabbix

## Цель работы

Ознакомление с системой Zabbix для мониторинга серверов, сервисов и сетевого оборудования.

## Задачи

- Установить и настроить сервер Zabbix.
- Установить агент Zabbix на контролируемую машину.
- Добавить и настроить хост в системе.
- Просмотреть собираемые метрики и создать оповещения.

## Необходимое оборудование и программное обеспечение

- Две виртуальные машины (например, Ubuntu Server 22.04)
- Доступ в Интернет
- Zabbix Server + MySQL + Apache/Nginx
- Zabbix Agent

## Ход выполнения работы

### Шаг 0. Подготовка среды

Для выполнения лабораторной работы были созданы **две виртуальные машины** в среде *Oracle VirtualBox* на основе образа **Ubuntu Server 22.04**.
На каждой машине был установлен графический интерфейс и выполнена базовая настройка системы.

#### Настройка сети

Для обеспечения связи между сервером Zabbix и агентом использовалось два сетевых адаптера:

- **Адаптер 1:** NAT — для доступа в Интернет;
- **Адаптер 2:** Сетевой мост (или «Внутренняя сеть») — для связи между машинами.

После добавления второго адаптера были заданы статические IP-адреса:

| Машина        | Назначение         | IP-адрес        |
| ------------- | ------------------ | --------------- |
| Zabbix Server | Сервер мониторинга | `192.168.100.1` |
| Zabbix Agent  | Агентская машина   | `192.168.100.2` |

#### Настройка интерфейса enp0s8

Настройка статического IP выполнялась в конфигурационном файле сети:

```bash
sudo nano /etc/netplan/01-netcfg.yaml
```

Пример содержимого:

```yaml
network:
  version: 2
  ethernets:
    enp0s8:
      dhcp4: no
      addresses: [192.168.100.1/24]
```

После изменения конфигурации сеть была перезапущена:

```bash
sudo netplan apply
```

Для проверки корректности настройки использовались команды:

```bash
ip a
ping 192.168.100.2
```

### Шаг 1. Установка и настройка Zabbix Server

#### Обновление пакетов на сервере мониторинга

Перед установкой `Zabbix` на виртуальной машине `zabbix-server` необходимо выполнить стандартную процедуру обновления репозиториев и уже установленных пакетов.

1. Сначала нужно обновить список доступных пакетов:

```bash
sudo apt update
```

Команда опрашивает настроенные репозитории **Ubuntu** и загружает актуальные метаданные о доступных версиях пакетов.
По завершении система сообщила, что все списки пакетов успешно прочитаны.

![image](https://i.imgur.com/rCJMlCp.png)

2. Затем необходимо обновить сами пакеты до последних версий:

```bash
sudo apt upgrade -y
```

Ключ `-y` используется для автоматического согласия со всеми стандартными вопросами установщика, чтобы не подтверждать обновление каждого пакета вручную. В результате были обновлены базовые компоненты системы (библиотеки, системные утилиты, графика, сетевые пакеты и т.д.), что снижает риск проблем при последующей установке Zabbix Server и его зависимостей.

![image](https://i.imgur.com/VOQbsVC.png)

После завершения обновления сервер перезагружать не требуется, так как критичных обновлений ядра или системных сервисов не было. Система готова к установке репозитория Zabbix.

#### Добавление официального репозитория Zabbix

Для установки системы мониторинга `Zabbix` на сервер под управлением **Ubuntu 22.04** предварительно нужно подключить официальный репозиторий версии **6.4**, обеспечивающий доступ к актуальным пакетам сервера, агента и веб-интерфейса.

Для этого нужно выполнить команды:

```bash
wget https://repo.zabbix.com/zabbix/6.4/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.4-1+ubuntu22.04_all.deb
sudo dpkg -i zabbix-release_6.4-1+ubuntu22.04_all.deb
sudo apt update
```

Команда `wget` скачивает пакет с настройками репозитория Zabbix.
Команда `dpkg -i` устанавливает данный пакет, добавляя репозиторий в систему.
После этого выполняется обновление индекса пакетов, чтобы система могла получать обновления и устанавливать компоненты Zabbix напрямую из официальных источников.

![image](https://i.imgur.com/eT6gg4f.png)
![image](https://i.imgur.com/4aaTCgK.png)

В процессе обновления появляется предупреждение о 32-битной архитектуре (`i386`), которое можно игнорировать — система работает на 64-битной версии Ubuntu.
Репозиторий успешно добавлен, что подтверждается корректным завершением команды `apt update`.

#### Установка и настройка Zabbix Server

Для развертывания системы мониторинга на виртуальной машине с IP-адресом **192.168.100.1** необходимо установить **Zabbix Server** с веб-интерфейсом (**Zabbix Frontend**) для централизованного управления и наблюдения за инфраструктурой.

Установку нужно выполнить с помощью команды:

```bash
sudo apt install zabbix-server-mysql zabbix-frontend-php zabbix-apache-conf zabbix-sql-scripts -y
```

Во время установки автоматически были загружены и установлены все необходимые зависимости: **Apache2**, **PHP 8.1**, **MySQL client**, а также дополнительные модули для работы с LDAP, SNMP и другими сервисами.

![image](https://i.imgur.com/CWWkAsJ.png)

>**Zabbix Server** является основным компонентом, отвечающим за сбор и обработку данных с наблюдаемых хостов.
>
>**Zabbix Frontend** представляет собой веб-интерфейс, через который осуществляется настройка хостов, триггеров и просмотр метрик.
>
>Благодаря установленным компонентам **Apache** и **SQL-скриптам** обеспечена корректная работа веб-интерфейса и взаимодействие с сервером.

### Шаг 2. Настройка базы данных и подключение веб-интерфейса

После установки серверной части Zabbix требуется настроить базу данных и веб-интерфейс для корректной работы системы.

#### Установка и настройка MariaDB

Для хранения данных мониторинга выбрана система управления базами данных **MariaDB**, установленная с помощью команды:

```bash
sudo apt install mariadb-server -y
```

![image](https://i.imgur.com/y8K4jXK.png)

После установки СУБД надо выполнить вход под пользователем `root` и создать базу данных **zabbix** с отдельным пользователем и паролем:

```bash
sudo mysql -uroot -p
CREATE DATABASE zabbix CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;
CREATE USER 'zabbix'@'localhost' IDENTIFIED BY 'zabbix123';
GRANT ALL PRIVILEGES ON zabbix.* TO 'zabbix'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

![image](https://i.imgur.com/s1s4LNl.png)

#### Импорт структуры базы данных

Далее следует импортировать стандартный SQL-скрипт с таблицами и схемой данных Zabbix:

```bash
sudo zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql -uzabbix -pzabbix123 zabbix
```

![image](https://i.imgur.com/sFzvavj.png)

После успешного выполнения команда:

```bash
mysql -uzabbix -pzabbix123 -D zabbix -e "SHOW TABLES;"
```

![image](https://i.imgur.com/ZijtXkP.png)

подтверждает, что в базе созданы все необходимые таблицы Zabbix.

#### Запуск Zabbix Server

После внесения изменений нужно перезапустить службы:

```bash
sudo systemctl restart apache2
sudo systemctl restart zabbix-server
sudo systemctl status zabbix-server
```

Статус службы подтверждает, что **Zabbix Server активен и работает** `(Active: running)`.

![image](https://i.imgur.com/oeEX7kT.png)

#### Первоначальная настройка Zabbix через веб-интерфейс

В браузере стал доступен установочный мастер по адресу:

```
http://localhost/zabbix
```

![image](https://i.imgur.com/BKicTrb.png)

### Шаг 3. Установка Zabbix Agent на второй машине

Для мониторинга удалённой системы необходимо установить агент **Zabbix Agent** на второй виртуальной машине с IP-адресом **192.168.100.2**. Агент отвечает за сбор локальных метрик (нагрузка на процессор, использование памяти, сетевые параметры и т.д.) и передачу их на сервер Zabbix.

#### Обновление системы и добавление репозитория

Перед установкой агента надо выполнить стандартную процедуру обновления пакетов и подключения официального репозитория Zabbix.

```bash
sudo apt update
sudo apt upgrade -y
```

![image](https://i.imgur.com/2Yx13NY.png)

После установки `wget` был загружен и установлен пакет репозитория Zabbix версии **6.4**:

```bash
sudo apt install wget -y
wget https://repo.zabbix.com/zabbix/6.4/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.4-1+ubuntu22.04_all.deb
sudo dpkg -i zabbix-release_6.4-1+ubuntu22.04_all.deb
sudo apt update
```

![image](https://i.imgur.com/3fj8g48.png)
![image](https://i.imgur.com/j1rvByw.png)

Репозиторий успешно добавлен.

#### Установка Zabbix Agent

Далее на агентской машине нужно установить пакет агента:

```bash
sudo apt install zabbix-agent -y
```

Во время установки автоматически добавились зависимости, включая библиотеку `libmodbus5`.

![image](https://i.imgur.com/OyLI3dt.png)

#### Настройка конфигурационного файла агента

После установки агент нужно настроить для связи с сервером Zabbix.
Конфигурационный файл находится по пути:

```bash
sudo nano /etc/zabbix/zabbix_agentd.conf
```

В нём необходимо изменить следующие параметры:

```ini
Server=192.168.100.1
ServerActive=192.168.100.1
Hostname=ZabbixAgent
```

Параметр `Server` задаёт IP-адрес Zabbix-сервера, которому разрешено подключение к агенту.
`ServerActive` определяет, куда агент отправляет активные проверки.
`Hostname` — это имя хоста, под которым агент будет отображаться в веб-интерфейсе Zabbix.

![image](https://i.imgur.com/KjQ3FYN.png)
![image](https://i.imgur.com/xa6rgFD.png)

#### Запуск и проверка работы агента

После настройки конфигурации службу агента нужно перезапустить и добавить в автозагрузку:

```bash
sudo systemctl restart zabbix-agent
sudo systemctl enable zabbix-agent
sudo systemctl status zabbix-agent
```

![image](https://i.imgur.com/ujrkps0.png)

В выводе команды видно, что служба **активна (Active: running)**, что подтверждает успешный запуск агента.

На этом установка и настройка **Zabbix Agent** завершены.
Теперь сервер Zabbix (`192.168.100.1`) может подключаться к агенту (`192.168.100.2`) для получения данных мониторинга.

#### Настройка веб-интерфейса Zabbix (Frontend)

После установки и запуска служб `zabbix-server` и `apache2` веб-интерфейс Zabbix становится доступен в браузере по адресу:

```
http://localhost/zabbix
```

![image](https://i.imgur.com/BKicTrb.png)

Открывается **установочный мастер Zabbix**, который позволяет пошагово выполнить конфигурацию подключения к базе данных и задать основные параметры системы.

#### Проверка системных требований

На этом этапе происходит проверка конфигурации PHP и установленных модулей.
Система проверяет наличие необходимых расширений (`bcmath`, `mbstring`, `mysqli`, `xml`, `gd` и т.д.), а также параметры `memory_limit`, `max_execution_time` и `upload_max_filesize`.

Все параметры удовлетворяют требованиям (статус — `OK`).

![image](https://i.imgur.com/HK8gtkE.png)

#### Настройка подключения к базе данных

На данном этапе указываются параметры подключения к базе данных, созданной ранее в **MariaDB**.

| Параметр          | Значение         |
| ----------------- | ---------------- |
| **Database type** | MySQL            |
| **Database host** | localhost        |
| **Database port** | 0 (по умолчанию) |
| **Database name** | zabbix           |
| **User**          | zabbix           |
| **Password**      | zabbix123        |

После заполнения всех полей нажимается кнопка **Next step**.

![image](https://i.imgur.com/C98Tvam.png)

#### Настройка параметров сервера

На следующем экране задаются параметры веб-интерфейса, включая имя сервера, часовой пояс и цветовую тему интерфейса.

| Параметр               | Значение        |
| ---------------------- | --------------- |
| **Zabbix server name** | zabbix          |
| **Default time zone**  | Europe/Chisinau |
| **Default theme**      | Blue            |

![image](https://i.imgur.com/IN17cYT.png)

#### Проверка параметров установки

Перед завершением отображается сводка всех введённых настроек:
тип базы данных, сервер, имя пользователя, порт и имя сервера Zabbix.
После проверки нажимается кнопка **Next step**.

![image](https://i.imgur.com/ly2yHMV.png)

#### Завершение установки

После успешного прохождения всех этапов появляется сообщение:

> **Congratulations! You have successfully installed Zabbix frontend.**

![image](https://i.imgur.com/spwP4yP.png)

Это означает, что конфигурационный файл `zabbix.conf.php` успешно создан, и система готова к работе.

#### Вход в систему

Открывается страница входа в интерфейс Zabbix.
Для авторизации необходимо использовать стандартные учётные данные:

- **Username:** Admin
- **Password:** zabbix

![image](https://i.imgur.com/37lloym.png)

### Шаг 4. Добавление хоста в веб-интерфейсе Zabbix

После успешной установки сервера и агента необходимо добавить второй узел (клиентскую машину) в систему мониторинга через веб-интерфейс Zabbix.

Для этого в меню выбирается пункт:

**Data collection → Hosts** и нажимается кнопка **Create host**.

![image](https://i.imgur.com/XAMGmPk.png)

#### Добавление нового хоста

В открывшемся окне задаются основные параметры:

| Поле             | Значение              |
| ---------------- | --------------------- |
| **Host name**    | zabbix-agent          |
| **Visible name** | zabbix-agent          |
| **Templates**    | Linux by Zabbix agent |
| **Host groups**  | Linux servers         |
| **IP address**   | 192.168.100.2         |
| **Port**         | 10050                 |

После заполнения параметров необходимо убедиться, что пункт **Enabled** активен, и нажать **Add**.

![image](https://i.imgur.com/6sIFiEk.png)

#### Проверка статуса хоста

После добавления нового узла он появляется в списке хостов.
Для него автоматически применяется шаблон *Linux by Zabbix agent*, обеспечивающий сбор системных метрик (нагрузка CPU, использование RAM, доступность сервиса и т.д.).

Статус агента **ZBX = зелёный** означает, что сервер Zabbix успешно подключился к хосту 192.168.100.2 и получает данные.
Метрики начинают поступать через несколько минут (CPU, RAM, диск, сеть и т.д.).

![image](https://i.imgur.com/EsYw06m.png)

### Шаг 5. Проверка сбора данных (CPU, RAM, сеть)

Для проверки работы сбора данных в веб-интерфейсе необходимо перейти в раздел:

`Monitoring` → `Latest data`

Выбираем хост `zabbix-agent`. В списке появляются десятки элементов (items), которые обновляются в реальном времени — процессор, память, сеть, файловая система и т.д.

#### Общий список метрик

На странице видно, что данные активно поступают — большинство элементов имеют статус **With data**, что говорит о корректной работе агента и связи с сервером.

#### CPU (Процессор)

Агент передаёт полную статистику по загрузке CPU, включая пользовательское и системное время, а также процент простоя.
Например:

- `system.cpu.util[,user]` — использование CPU пользователем;
- `system.cpu.util[,system]` — системная нагрузка;
- `system.cpu.util[,idle]` — доля времени простоя.

![image](https://i.imgur.com/xQFTgF7.png)

#### Оперативная память (RAM)

В этой группе отображаются данные об общей, свободной и используемой памяти:

- `vm.memory.size[total]` — общий объём;
- `vm.memory.size[available]` — доступный объём;
- `vm.memory.utilization` — процент использования оперативной памяти.

![image](https://i.imgur.com/iYsF5x2.png)

#### Сеть (Network)

Для сетевых интерфейсов `enp0s3` и `enp0s8` отображаются показатели трафика и ошибок передачи:

- `net.if.in["enp0s8"]` — входящий трафик;
- `net.if.out["enp0s8"]` — исходящий трафик;
- `net.if.in["enp0s8",errors]` — количество ошибок при приёме пакетов.

![image](https://i.imgur.com/mMkB78q.png)

#### Диск (Storage)

Zabbix отслеживает использование файловой системы и состояние диска `sda`:

- `vfs.fs.size[/,used]` — занятое пространство;
- `vfs.fs.size[/,free]` — свободное пространство;
- `vfs.fs.size[/,pused]` — процент использования.

![image](https://i.imgur.com/klFYhJD.png)

#### Итоги наблюдения

По результатам проверки видно, что агент стабильно передаёт данные по всем ключевым параметрам системы.
Метрики обновляются каждые несколько секунд, графики строятся корректно, а связь между сервером и агентом стабильна.
Это подтверждает, что **Zabbix настроен правильно и выполняет функции мониторинга**.

### Шаг 6. Настройка оповещения (триггер + действие)

После проверки получения метрик следующим шагом является настройка **оповещений** в системе Zabbix.
Для этого создаются **триггер** (условие возникновения проблемы) и **действие** (реакция на событие — например, уведомление администратора).

#### Создание триггера

В веб-интерфейсе Zabbix переходим в меню
**Data collection → Hosts → zabbix-agent → Triggers**
и нажимаем кнопку **Create trigger**.

В открывшемся окне заполняются основные поля:

| Поле           | Значение                                            |
| -------------- | --------------------------------------------------- |
| **Name**       | High CPU Load                                       |
| **Severity**   | High                                                |
| **Expression** | `{zabbix-agent:system.cpu.load[all,avg1].last()}>2` |

![image](https://i.imgur.com/nTy6Oxs.png)

При сохранении возникла ошибка в выражении. Для корректной настройки триггер был создан с помощью `Expression constructor`, где выбран элемент `Linux: CPU idle time`, функция `last()` и условие = `0`.

![image](https://i.imgur.com/vpBsTyH.png)

После этого выражение корректно сформировалось, и система вывела сообщение:
**Trigger added**

![image](https://i.imgur.com/xHh5XMx.png)

#### Создание действия (Action)

Теперь нужно указать, что делать при срабатывании триггера.
В меню необходимо выбрать **Alerts → Actions → Create action** и задать параметры:

| Поле          | Значение                                     |
| ------------- | -------------------------------------------- |
| **Name**      | Notify on High CPU                           |
| **Condition** | Trigger equals `zabbix-agent: High CPU Load` |
| **Enabled**   | ☑                                            |

![image](https://i.imgur.com/IjTQSmD.png)

![image](https://i.imgur.com/M4vA6qp.png)

#### Добавление операции (Operation)

На вкладке **Operations** надо задать отправку уведомления:

- **Send to user groups:** Zabbix administrators
- **Send only to:** Email
- **Subject:** `High CPU Alert on zabbix-agent`
- **Step duration:** `1h`

![image](https://i.imgur.com/EWwmTlV.png)

![image](https://i.imgur.com/JhncTyl.png)

После сохранения система сообщает:
**Action added**

![image](https://i.imgur.com/8ZkgBi6.png)

После добавления операции действие активировано и готово к работе.

#### Результат шага

В результате при достижении 0 % CPU idle time (то есть при полной загрузке процессора) Zabbix автоматически создаёт событие и отправляет уведомление администраторам по e-mail.

### Шаг 7. Создание персональной панели мониторинга (Dashboard)

Для визуального контроля состояния системы и отслеживания метрик в реальном времени в Zabbix можно создать собственную панель мониторинга (**Dashboard**).

#### Создание новой панели

Переходим в меню
**Monitoring → Dashboards**
и нажимаем **Create dashboard**.

В открывшемся окне задаём параметры панели:

- **Name:** `Global view`
- **Owner:** текущий пользователь
- **Sharing:** Private (по умолчанию)

После подтверждения открывается пустая панель, готовая для добавления виджетов.

Нажимаем `Add widget`.

#### Добавление виджета с графиком CPU

Первым добавляем виджет типа **Graph** для отображения загрузки процессора.

Параметры:

- **Type:** Graph
- **Name:** `CPU Idle`
- **Refresh interval:** 30 seconds
- **Host:** `Zabbix server`
- **Item:** `Linux: CPU idle time`

После добавления график отображает изменение загрузки процессора в реальном времени.

![image](https://i.imgur.com/ERyTbbk.png)
![image](https://i.imgur.com/MuBrDOi.png)

#### Добавление обзора триггеров

Далее добавляем виджет типа **Data overview**, который показывает активные триггеры и состояния хостов.

Параметры:

- **Type:** Data overview
- **Name:** `Triggers overview`
- **Host groups:** `Zabbix servers`
- **Hosts:** `Zabbix server`
- **Refresh interval:** 1 minute

![image](https://i.imgur.com/KscRH9V.png)

#### Итоговая панель

После добавления виджетов панель мониторинга отображает ключевую информацию:

- **Host availability** — доступность хостов
- **Problems by severity** — количество проблем по уровням критичности
- **Current problems** — активные инциденты
- **CPU Idle** — график состояния процессора
- **Triggers overview** — список активных триггеров
- **Geomap** — географическое расположение хостов

![image](https://i.imgur.com/I5johbi.png)

#### Результат

Создана персональная панель мониторинга, которая в реальном времени отображает состояние системы и активные проблемы.
Теперь администратор может мгновенно отслеживать загрузку процессора, доступность хостов и активные триггеры через визуальный интерфейс Zabbix Dashboard.

## Контрольные вопросы

### 1. Какова роль основных компонентов Zabbix (Server, Agent, Proxy, Database, Frontend)?

- **Zabbix Server** — центральный компонент системы, собирающий и обрабатывающий данные от агентов и прокси, хранящий их в базе данных и выполняющий анализ по заданным триггерам.

- **Zabbix Agent** — устанавливается на контролируемых хостах, собирает локальные метрики (нагрузка CPU, память, диск, сеть) и передаёт их серверу.

- **Zabbix Proxy** — промежуточный компонент, используемый для сбора данных от агентов в удалённых сетях и последующей передачи их на сервер (уменьшает нагрузку и обеспечивает автономность).

- **Database (База данных)** — хранит всю информацию Zabbix: настройки, историю метрик, события, пользователи, триггеры и т.д.

- **Frontend (Веб-интерфейс)** — графическая оболочка для администратора, позволяющая управлять конфигурацией, просматривать графики, события, оповещения и панели мониторинга.

### 2. Как осуществляется связь между Zabbix Server и Zabbix Agent?

Связь устанавливается по сетевому протоколу **TCP**, по умолчанию через порт **10050** (agent) и **10051** (server).

- Сервер запрашивает данные у агента (active/passive checks), либо агент сам отправляет данные на сервер.

- Передача выполняется в зашифрованном виде (при включении TLS).

Таким образом обеспечивается двустороннее взаимодействие между системой мониторинга и контролируемыми хостами.

### 3. Что такое «items» и «triggers» в Zabbix?

- **Items (элементы данных)** — это параметры, которые Zabbix собирает с хостов: загрузка CPU, использование памяти, состояние диска и т.д. Каждый item определяет источник данных, частоту опроса и метод получения.

- **Triggers (триггеры)** — логические выражения, анализирующие значения items и определяющие наличие проблемы.
  Пример:

```
{zabbix-agent:system.cpu.load[all,avg1].last()}>2
```

Такой триггер сработает, если средняя нагрузка CPU превысит 2.

## Вывод

В ходе выполнения лабораторной работы была установлена и настроена система мониторинга **Zabbix**, предназначенная для централизованного сбора и анализа данных о состоянии информационных систем. В процессе работы были изучены основные компоненты платформы — сервер, агент, прокси, база данных и веб-интерфейс, а также реализована их взаимосвязь. Был добавлен хост с установленным агентом, настроен сбор ключевых метрик, таких как загрузка процессора, использование оперативной памяти, дисковое пространство и сетевой трафик. На основе собранных данных были созданы триггеры для автоматического определения проблем и действия для отправки уведомлений администраторам. В завершение была сформирована персональная панель мониторинга (dashboard), отображающая в реальном времени состояние системы, активные проблемы и графики производительности. Полученные результаты подтверждают успешное развертывание и настройку системы Zabbix, обеспечивающей эффективный мониторинг инфраструктуры и оперативное реагирование на возникающие инциденты.
